USE Foodie;


CREATE TABLE AppUsers
(
	Id INT PRIMARY KEY IDENTITY,
	Email NVARCHAR(320) UNIQUE NOT NULL,
	FirstName NVARCHAR(25)  NOT NULL,
	LastName NVARCHAR(25) NOT NULL,
	RegistrationDate SMALLDATETIME NOT NULL,
	Birthday DATE NOT NULL,
	PhoneNumber NVARCHAR(25) NOT NULL,
	UserRole NVARCHAR(10) CHECK(UserRole = 'Admin' OR UserRole = 'User'),
	PasswordHash VARBINARY(128) NOT NULL,
	PasswordSalt VARBINARY(128) NOT NULL
);

CREATE TABLE Dishes
(
	Id INT PRIMARY KEY IDENTITY,
	Name NVARCHAR(25) NOT NULL,
	CookingTime TIME NOT NULL,
	YouWillNeed NVARCHAR(120) NOT NULL,
	DishWeight INT NOT NULL CHECK(DishWeight > 0),
	Price MONEY NOT NULL,
	IsVisible BIT NOT NULL,
	Ingredients NVARCHAR(120) NOT NULL
);

CREATE TABLE Photos
(
	Id INT PRIMARY KEY IDENTITY,
	Url NVARCHAR(200) NOT NULL,
	PublicId NVARCHAR(100) NOT NULL,

	DishId INT FOREIGN KEY REFERENCES Dishes(Id)
);

CREATE TABLE Orders
(
	Id INT PRIMARY KEY IDENTITY,
	OrderDate SMALLDATETIME NOT NULL,
	DeliveryDate SMALLDATETIME NOT NULL,
	TotalPrice MONEY NOT NULL CHECK(TotalPrice > 0),
	Status NVARCHAR(25) NOT NULL,
	Address NVARCHAR(120) NOT NULL,

	AppUserId INT FOREIGN KEY REFERENCES AppUsers(Id)
);

CREATE TABLE OrderDishes
(
	Id INT PRIMARY KEY IDENTITY,
	DishesCount INT NOT NULL CHECK(DishesCount > 0),

	OrderId INT FOREIGN KEY REFERENCES Orders(Id),
	DishId INT FOREIGN KEY REFERENCES Dishes(Id)
);
